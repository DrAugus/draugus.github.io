import{k as W,n as se,l as F,D as N,E as U,F as V,h as Q}from"./utils.CNxR7VHF.js";import{p as ne}from"./wishInfo.Cx1C-jo1.js";import"./zh.Df1gZo2Y.js";import{d as ae,v as ie,x as re,o as l,c as o,j as s,a as le,F as h,B as y,N as v,t as m,k as i,n as A,p as _,P as oe,_ as Y,r as ce}from"./framework.D_SSYBI4.js";const de={class:"hide-on-small-only"},ue={style:{textAlign:"center"}},me={class:"timeline-month"},he={class:"timeline-month-text"},fe={class:"timeline-day"},ve={class:"timeline-today-line-pos-text"},ge={class:"timeline-wish-event-weapon"},ye={class:"event-img"},_e=["src"],pe={class:"left-align timeline-character-text sticky text-shadow-weapon"},we={class:"timeline-wish-event-character"},xe={class:"event-img responsive-img lazy"},Ae=["src"],be={class:"timeline-day-index"},Ce={class:"timeline-week-index"},f=40,Ee=ae({__name:"Timeline",props:{WISH:{},CHARACTER:{},GAME_NAME:{}},setup(c){W.locale("zh");const p=c,u=se(p.GAME_NAME),b=_(null),C=_(null),T=async()=>{await oe(),b.value&&C.value&&(b.value.scrollLeft=C.value.offsetLeft-window.innerWidth/2)};let k=-1,$=_("");const w=ne(p.WISH),Z=W(),R=w.firstDay,x=w.events[F.Characters],g=w.events[F.Weapons],q=x.length,J=g.length,K=w.dates,X=w.monthList,S=(Math.abs(R.diff(Z,"day",!0))+1)*(f+1)+"px",I=R;let M=_([]),D=_([]),H=_([]);ie(async()=>{for(let e=0;e<q;++e){const n=N(x[e].start).subtract(0,"minute");M.value.push(n.diff(I,"day",!0))}for(let e=0;e<J;++e){const n=N(g[e].start).subtract(0,"minute");D.value.push(n.diff(I,"day",!0));let t=g[e].image;H.value.push(Array.isArray(t)?t.length:1)}k=setInterval(()=>{$.value=W().format("HH:mm:ss")},1e3),T()}),re(()=>{k&&clearInterval(k)});function L(e,n){return e==n?0:N(n).subtract(0,"minute").diff(N(e).subtract(0,"minute"),"hour",!0)<1?1:-1}function E(e,n){const t=e.length;if(!t)return"";let a="";if(n===0)a+="rounded-l-xl ";else if(n===t-1)a+="rounded-r-xl ";else{let d=L(e[n].end,e[n+1].start);d===1?a+="border-r-4 border-white ":d===-1&&(a+="rounded-r-xl ");let r=L(e[n-1].end,e[n].start);r===1?a+="border-r-4 border-white ":r===-1&&(a+="rounded-l-xl ")}return a.includes("rounded-r-xl")&&(a=a.replace("border-r-4 border-white ","")),a}function P(e){e.target.src=`/image/${u}/wish/_1.jpg`}function j(e,n){var d;let t=H.value[e],a="";return t==2&&(a=`calc((var(--event-height) + var(--event-height-dur)) * ${n})`),{width:((d=g[e])==null?void 0:d.duration)*(f+1)+"px",left:(D.value[e]+1)*(f+1)+"px",height:"var(--event-height)",marginTop:a}}function ee(e,n){var d;let t=H.value[e];t||(t=1);let a=`calc((var(--event-height) + var(--event-height-dur)) * ${t-1+n})`;return{width:((d=x[e])==null?void 0:d.duration)*(f+1)+"px",left:(M.value[e]+1)*(f+1)+"px",marginTop:a}}function te(e){return Array.isArray(e)?e:[e]}return(e,n)=>(l(),o(h,null,[s("div",de,[s("p",ue,[n[1]||(n[1]=le(" 也许有未实装、未确定的虚假信息 ",-1)),s("a",{onClick:n[0]||(n[0]=t=>T())},"回到当前时间")]),s("div",{class:"timeline-scroll-x",ref_key:"setNowPos",ref:b},[s("div",me,[(l(!0),o(h,null,y(i(X),(t,a)=>(l(),o("div",null,[s("div",{style:v({width:(f+1)*t[1].total+"px"})},[s("span",he,m(t[0]),1)],4)]))),256))]),s("div",fe,[s("div",{style:v(S?{left:S}:""),class:"timeline-today-line-pos",ref_key:"findNowPos",ref:C},[s("div",ve,m(i($)),1)],4),s("div",ge,[(l(!0),o(h,null,y(c.WISH.weapons,(t,a)=>(l(),o("div",null,[(l(!0),o(h,null,y(te(t.image),(d,r)=>(l(),o("div",null,[s("div",{class:A(["card event-item weapon",[E(i(g),a)]]),style:v(j(a,r))},[s("div",{class:A(["card-image waves-effect waves-block waves-light",[E(i(g),a)]]),style:{height:"100%"}},[s("div",ye,[s("img",{src:`/image/${i(u)}/wish/${i(U)(t.name,d)}`,onError:P,alt:""},null,40,_e)]),s("span",pe,m(i(V)("",c.GAME_NAME,r+1)),1)],2)],6)]))),256))]))),256))]),s("div",we,[(l(!0),o(h,null,y(c.WISH.characters,(t,a)=>(l(),o("div",null,[(l(!0),o(h,null,y(t.name,(d,r)=>{var B,G,O,z;return l(),o("div",null,[s("div",{class:A(["card event-item",["ele-"+((G=(B=c.CHARACTER[t.wish5star[r]])==null?void 0:B.ele)==null?void 0:G.id),E(i(x),a)]]),style:v(ee(a,r))},[s("div",{class:A(["card-image waves-effect waves-block waves-light",[E(i(x),a)]]),style:{height:"100%"}},[s("div",xe,[s("img",{src:`/image/${i(u)}/wish/${i(U)(t.name[r],t.image[r])}`,onError:P,alt:""},null,40,Ae)]),s("span",{class:A(["left-align timeline-character-text sticky","ele-text-shadow-"+((z=(O=c.CHARACTER[t.wish5star[r]])==null?void 0:O.ele)==null?void 0:z.id)])},m(i(Q)(t.wishName[r])+i(V)("活动x",c.GAME_NAME)+i(Q)(c.CHARACTER[t.wish5star[r]].prefix+"·"+c.CHARACTER[t.wish5star[r]].name)),3)],2)],6)])}),256))]))),256))]),(l(!0),o(h,null,y(i(K),(t,a)=>(l(),o("div",{style:v({marginLeft:f}),class:"timeline-wrapper"},[s("span",be,m(t[0]),1),s("span",Ce,m(t[1]),1)],4))),256))])],512)]),n[2]||(n[2]=s("div",{class:"hide-on-large-only"},null,-1))],64))}}),Le=Y(Ee,[["__scopeId","data-v-0047352f"]]),Ne={data(){return{}},props:{style:Object,name:"",text:"",tagline:"",textColor:""},components:{}},Te={class:"container"},ke={class:"title"},He={class:"sub-title"},We={class:"section-b"};function $e(c,p,u,b,C,T){return l(),o("div",Te,[s("div",{class:"section-a",style:v(u.style)},[p[0]||(p[0]=s("div",{class:"background"},null,-1)),s("div",ke,m(u.name),1),s("div",He,m(u.text),1),s("div",{class:"tagline",style:v({color:u.textColor})},m(u.tagline),5)],4),s("div",We,[ce(c.$slots,"default",{},void 0,!0)])])}const Pe=Y(Ne,[["render",$e],["__scopeId","data-v-4499daee"]]);export{Pe as A,Le as T};
